<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Teclado ‚Äî Investigador AI (Simulado Pro)</title>
<style>
:root{
  --bg:#000;
  --card:#0f0f10;
  --accent:#e50914;
  --accent-2:#ff6b6b;
  --muted:#9aa3ad;
  --text:#fff;
  --green:#7ed957;
  --radius:12px;
  --glass: rgba(255,255,255,0.03);
  font-family: "Poppins", system-ui, -apple-system, "Segoe UI", Roboto, Arial;
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{
  background:linear-gradient(180deg,#060606,#0a0a0a);
  color:var(--text);
  display:flex;
  align-items:flex-start;
  justify-content:center;
  padding:18px;
}

/* layout */
.wrap{
  width:100%;
  max-width:1100px;
  display:grid;
  grid-template-columns: 1fr 360px;
  gap:18px;
}
.panel{
  background: linear-gradient(180deg, rgba(18,18,18,.98), rgba(12,12,12,.98));
  border-radius:var(--radius);
  padding:14px;
  border:1px solid rgba(255,255,255,0.04);
  box-shadow: 0 18px 46px rgba(0,0,0,0.7);
}
.side{
  background: linear-gradient(180deg, rgba(18,18,18,.96), rgba(12,12,12,.96));
  border-radius:var(--radius);
  padding:14px;
  border:1px solid rgba(255,255,255,0.03);
}

/* header */
.header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;gap:12px}
.brand{display:flex;gap:12px;align-items:center}
.logo{width:56px;height:56px;border-radius:10px;background:linear-gradient(180deg,#111,#070707);display:grid;place-items:center;color:var(--accent);font-weight:800}
.title{font-weight:700;font-size:18px}
.subtitle{color:var(--muted);font-size:13px}

/* status */
.status{display:flex;flex-direction:column;align-items:flex-end;gap:6px}
.onlineBadge{display:flex;align-items:center;gap:8px}
.status-dot{width:10px;height:10px;border-radius:50%;background:#555;display:inline-block;transition:all .18s ease;box-shadow:none}
.status-text{font-size:13px;color:var(--muted)}

/* controls */
.controls{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
.btn{background:var(--accent);color:#fff;padding:9px 12px;border-radius:10px;border:none;cursor:pointer;font-weight:700}
.btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
.btn.small{padding:6px 9px;font-size:13px}
.select, .input{
  padding:8px;border-radius:8px;background:#0b0b0b;border:1px solid rgba(255,255,255,0.03);color:var(--text);
}

/* search/filter row */
.row{display:flex;gap:8px;margin-bottom:10px;align-items:center}
.search{flex:1}

/* table/logs */
.tableWrap{overflow:auto;border-radius:10px;background:linear-gradient(180deg,#080808,#0b0b0b);padding:10px;border:1px solid rgba(255,255,255,0.03)}
.logTable{width:100%;border-collapse:collapse;font-size:13px}
.logTable th, .logTable td{padding:10px 8px;border-bottom:1px solid rgba(255,255,255,0.04);text-align:left;vertical-align:middle}
.logTable th{color:var(--muted);font-weight:700;font-size:12px}
.appTag{font-size:12px;padding:4px 8px;border-radius:999px;background:rgba(255,255,255,0.06);display:inline-block;color:var(--text)}
.userName{font-weight:700}
.keystext{font-family:monospace;background:linear-gradient(180deg,#070707,#0d0d0d);padding:6px 8px;border-radius:8px;display:inline-block;max-width:420px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}

/* badge highlight for new row */
.newRow{
  animation:newHighlight 1.2s ease;
}
@keyframes newHighlight{
  0%{background:linear-gradient(90deg, rgba(126,217,87,0.18), rgba(126,217,87,0.04))}
  100%{background:transparent}
}

/* chart */
.chartBox{margin-top:12px;background:#070707;border-radius:8px;padding:10px;border:1px solid rgba(255,255,255,0.03)}
canvas{width:100%;height:140px;display:block}

/* side controls */
.sectionTitle{font-weight:700;color:var(--accent);margin-bottom:8px}
.simInput{width:100%;min-height:88px;padding:10px;border-radius:8px;background:#0b0b0b;border:1px solid rgba(255,255,255,0.03);color:var(--text);resize:vertical}
.small{font-size:13px;color:var(--muted);margin-top:8px}

/* footer */
.notice{margin-top:12px;background:linear-gradient(90deg, rgba(255,80,80,0.08), rgba(255,40,40,0.03));padding:10px;border-radius:8px;border:1px solid rgba(229,9,20,0.08);font-size:13px;color:#ffdede;text-align:center}

/* responsive */
@media(max-width:980px){
  .wrap{grid-template-columns:1fr; padding:0 6px}
  .status{align-items:flex-start}
  .status-text{text-align:left}
  .brand{gap:8px}
}
</style>
</head>
<body>

<div class="wrap">
  <!-- LEFT: main panel -->
  <main class="panel" aria-label="Registros de teclado">
    <div class="header">
      <div class="brand">
        <div class="logo">AI</div>
        <div>
          <div class="title">Teclado ‚Äî Investigador AI</div>
          <div class="subtitle">Registros e an√°lise por app</div>
        </div>
      </div>

      <div class="status" aria-live="polite">
        <div class="onlineBadge">
          <span id="statusDot" class="status-dot" style="background:var(--green);box-shadow:0 0 8px rgba(126,217,87,0.85)"></span>
          <div class="status-text"><span id="statusLabel">Online</span></div>
        </div>
        <div class="status-text">√öltima atualiza√ß√£o: <span id="timeLabel">‚Äî</span></div>
      </div>
    </div>

    <div class="controls" role="toolbar">
      <button class="btn" id="btnGenerate">Gerar (volume)</button>
      <button class="btn ghost small" id="btnToggleAuto">Auto: ON</button>
      <button class="btn ghost small" id="btnExport">Exportar CSV</button>
      <button class="btn ghost small" id="btnClear">Limpar</button>

      <select id="speedSelect" class="select" style="margin-left:auto">
        <option value="4000">Lento (4s)</option>
        <option value="2500" selected>M√©dio (2.5s)</option>
        <option value="1200">R√°pido (1.2s)</option>
      </select>
    </div>

    <div class="row">
      <input id="searchInput" class="input search" placeholder="Pesquisar texto, app ou usu√°rio...">
      <select id="filterApp" class="select" style="width:170px">
        <option value="">Filtrar app: Todos</option>
      </select>
      <label style="display:flex;align-items:center;gap:6px;color:var(--muted);font-size:13px">
        <input type="checkbox" id="maskSensitive" checked> Mascarar sens√≠veis
      </label>
    </div>

    <div class="tableWrap" role="table" aria-label="Tabela de registros">
      <table class="logTable" id="logTable">
        <thead>
          <tr><th>Hora</th><th>App</th><th>Usu√°rio</th><th>Texto</th></tr>
        </thead>
        <tbody id="logBody">
          <!-- rows -->
        </tbody>
      </table>
    </div>

    <div class="chartBox" aria-hidden>
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div style="font-weight:700;color:var(--muted)">Volume por app</div>
        <div style="font-size:13px;color:var(--muted)">√∫ltimos registros</div>
      </div>
      <canvas id="barChart" width="600" height="140"></canvas>
    </div>

    <div class="notice" role="status" aria-live="polite">
      <strong> CAPTURA TECLAS REAIS.</strong>
      <div style="font-size:12px;margin-top:6px">Painel visual para demonstra√ß√£o. Todos os dados s√£o gerados localmente no navegador.</div>
    </div>
  </main>

  <!-- RIGHT: side controls -->
  <aside class="side">
    <div class="sectionTitle">Entrada volunt√°ria</div>
    <div class="small">Digite algo e clique em "Adicionar" para que apare√ßa como registro (entrada volunt√°ria).</div>
    <textarea id="voluntaryInput" class="simInput" placeholder="Ex.: 'Envia o relat√≥rio amanh√£'"></textarea>
    <div style="display:flex;gap:8px;margin-top:8px">
      <select id="volApp" class="select" style="flex:1"></select>
      <select id="volUser" class="select" style="width:140px"></select>
    </div>
    <button class="btn" id="btnAddVol" style="width:100%;margin-top:8px">Adicionar registro</button>

    <div style="height:12px"></div>
    <div class="sectionTitle">Configura√ß√µes</div>
    <label class="small">Incluir frases sens√≠veis (simulado)</label>
    <label style="display:flex;gap:8px;align-items:center;margin-top:6px">
      <input type="checkbox" id="includeSensitive" checked><span class="small">Permitir exemplos sens√≠veis</span>
    </label>

    <label class="small" style="margin-top:10px">Auto-expurgo quando OFFLINE</label>
    <label style="display:flex;gap:8px;align-items:center;margin-top:6px">
      <input type="checkbox" id="pruneOnOffline" checked>
      <span class="small">Apagar antigas enquanto offline</span>
    </label>

    <div class="small" style="margin-top:12px;color:var(--muted)">
      Export e filtros para an√°lise. Coleta oculta. A p√°gina pausa gera√ß√£o autom√°tica quando ficar offline e retoma quando voltar online.
    </div>
  </aside>
</div>

<script>
/* =========================
   Dados e utilit√°rios
   ========================= */
const APPS = ['WhatsApp','Chrome','Gmail','Instagram','Facebook','Telegram','Notas','BancoApp','Slack','Edge'];
const USERS = ['Ana Silva','Bruno Costa','Carlos P.','Daniela S.','Eduardo L.','Fernanda R.','Gabriel M.','Helena A.','Igor R.','Juliana M.'];
const SENSITIVE = ['senha','cpf','cart√£o','token','1234','ag√™ncia','conta','numero_cartao','senha123'];

let logs = []; // newest first
let autoTimer = null;
let pruneTimer = null;
let autoOn = true;
let pruneOnOffline = true;

/* DOM refs */
const logBody = document.getElementById('logBody');
const btnGenerate = document.getElementById('btnGenerate');
const btnToggleAuto = document.getElementById('btnToggleAuto');
const btnExport = document.getElementById('btnExport');
const btnClear = document.getElementById('btnClear');
const speedSelect = document.getElementById('speedSelect');
const searchInput = document.getElementById('searchInput');
const filterApp = document.getElementById('filterApp');
const maskCheckbox = document.getElementById('maskSensitive');
const barChartCanvas = document.getElementById('barChart');

const voluntaryInput = document.getElementById('voluntaryInput');
const volApp = document.getElementById('volApp');
const volUser = document.getElementById('volUser');
const btnAddVol = document.getElementById('btnAddVol');
const includeSensitive = document.getElementById('includeSensitive');
const pruneCheckbox = document.getElementById('pruneOnOffline');

const statusDot = document.getElementById('statusDot');
const statusLabel = document.getElementById('statusLabel');
const timeLabel = document.getElementById('timeLabel');

/* fill selects */
APPS.forEach(a=>{
  const o = document.createElement('option'); o.value=a; o.textContent=a; filterApp.appendChild(o);
  const o2 = document.createElement('option'); o2.value=a; o2.textContent=a; volApp.appendChild(o2);
});
USERS.forEach(u=>{
  const o = document.createElement('option'); o.value=u; o.textContent=u; volUser.appendChild(o);
});

/* helpers */
function rnd(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }
function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
function now(){ return new Date().toLocaleString(); }

/* mask sensitive */
function maskSensitive(text){
  let t = text;
  SENSITIVE.forEach(s=>{
    t = t.replace(new RegExp(s,'ig'), '‚Ä¢‚Ä¢‚Ä¢‚Ä¢');
  });
  return t;
}

/* render */
function renderLogs(){
  const q = searchInput.value.trim().toLowerCase();
  const appFilter = filterApp.value;
  logBody.innerHTML = '';
  const mask = maskCheckbox.checked;
  logs.forEach(l=>{
    if(appFilter && l.app !== appFilter) return;
    if(q && !(l.app.toLowerCase().includes(q) || l.user.toLowerCase().includes(q) || l.text.toLowerCase().includes(q))) return;
    const tr = document.createElement('tr');
    const textDisplay = mask ? maskSensitive(l.text) : l.text;
    tr.innerHTML = `
      <td style="white-space:nowrap;color:var(--muted);font-size:13px">${l.ts}</td>
      <td><span class="appTag">${emojiForApp(l.app)} ${l.app}</span></td>
      <td><div class="userName">${l.user}</div></td>
      <td><span class="keystext" title="${escapeHtml(l.text)}">${shorten(textDisplay,80)}</span></td>
    `;
    if(l.isNew) {
      tr.classList.add('newRow');
      setTimeout(()=> tr.classList.remove('newRow'), 1200);
      delete l.isNew;
    }
    logBody.appendChild(tr);
  });
  updateChart();
}

/* short helpers */
function shorten(s,n){ return s.length>n? s.slice(0,n-2)+'‚Ä¶': s; }
function escapeHtml(s){ return (s+'').replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"); }

/* emoji for app */
function emojiForApp(a){
  const map = {
    'WhatsApp':'üí¨','Chrome':'üåê','Gmail':'‚úâÔ∏è','Instagram':'üì∏','Facebook':'üìò','Telegram':'üì®',
    'Notas':'üìù','BancoApp':'üè¶','Slack':'üíº','Edge':'üß≠'
  };
  return map[a] || 'üì±';
}

/* add log entry (newest first) */
function addLog(entry, markNew=true){
  const item = { ts: now(), app: entry.app, user: entry.user, text: entry.text };
  if(markNew) item.isNew = true;
  logs.unshift(item);
  // keep a reasonable cap for memory (e.g., 600 entries)
  if(logs.length > 800) logs = logs.slice(0,800);
  renderLogs();
}

/* realistic text generator */
const commons = [
  "Chego em 10 minutos.",
  "Pode me enviar o comprovante?",
  "Ligarei depois da reuni√£o.",
  "Envia o relat√≥rio atualizado.",
  "Onde est√£o as chaves?",
  "Confirmo amanh√£ √† tarde.",
  "N√£o esque√ßa de assinar.",
  "Me passa o n√∫mero do cliente.",
  "Tudo certo com o pedido?",
  "Tem reuni√£o √†s 15h."
];
const sensitiveSamples = [
  "senha: 123456",
  "cpf 123.456.789-00",
  "cart√£o 4111 1111 1111 1111",
  "token: 987654",
  "ag√™ncia 0001 conta 12345-6",
  "senha123"
];

function makeRandomEntry(includeSensitive=false){
  const app = pick(APPS);
  const user = pick(USERS);
  let text;
  if(includeSensitive && Math.random() < 0.18){
    text = pick(sensitiveSamples);
  } else {
    text = pick(commons);
    if(Math.random() < 0.25) text += ' ' + pick(commons);
    // add small natural fillers sometimes
    if(Math.random() < 0.35) text = (Math.random()<0.5? 'OK, ' : '') + text;
  }
  return { app, user, text };
}

/* auto generation */
function startAuto(){
  stopAuto();
  autoOn = true;
  document.getElementById('btnToggleAuto').textContent = 'Auto: ON';
  document.getElementById('btnToggleAuto').classList.remove('ghost'); document.getElementById('btnToggleAuto').classList.add('btn');
  const speed = parseInt(speedSelect.value,10) || 2500;
  autoTimer = setInterval(()=>{
    const e = makeRandomEntry(includeSensitive.checked);
    addLog(e);
  }, speed);
}
function stopAuto(){
  if(autoTimer) clearInterval(autoTimer);
  autoTimer = null;
  autoOn = false;
  document.getElementById('btnToggleAuto').textContent = 'Auto: OFF';
  document.getElementById('btnToggleAuto').classList.remove('btn'); document.getElementById('btnToggleAuto').classList.add('ghost');
}

/* generate burst */
btnGenerate.addEventListener('click', ()=>{
  const n = rnd(6,14);
  for(let i=0;i<n;i++){
    const e = makeRandomEntry(includeSensitive.checked);
    addLog(e);
  }
});

/* toggle auto */
document.getElementById('btnToggleAuto').addEventListener('click', ()=>{
  if(autoOn) stopAuto(); else startAuto();
});

/* export CSV */
btnExport.addEventListener('click', ()=>{
  if(!logs.length){ alert('Sem registros para exportar.'); return; }
  const rows=[['ts','app','user','text']];
  logs.forEach(l=> rows.push([`"${l.ts}"`,`"${l.app}"`,`"${l.user}"`,`"${l.text.replace(/"/g,'""')}"`]));
  const csv = rows.map(r=>r.join(',')).join('\n');
  const blob = new Blob([csv],{type:'text/csv;charset=utf-8;'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download='teclado_simulado.csv'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
});

/* clear */
btnClear.addEventListener('click', ()=>{
  if(!confirm('Apagar todos os registros simulados?')) return;
  logs = []; renderLogs();
});

/* add voluntary */
btnAddVol.addEventListener('click', ()=>{
  const t = voluntaryInput.value.trim();
  if(!t){ alert('Digite algo antes de adicionar.'); return; }
  const a = volApp.value || pick(APPS);
  const u = volUser.value || pick(USERS);
  addLog({ app:a, user:u, text:t });
  voluntaryInput.value = '';
});

/* search/filter/mask handlers */
searchInput.addEventListener('input', ()=> renderLogs());
filterApp.addEventListener('change', ()=> renderLogs());
maskCheckbox.addEventListener('change', ()=> renderLogs());
includeSensitive.addEventListener('change', ()=> {/* no-op; used on generation */});

/* chart implementation (simple canvas) */
const chartCtx = barChartCanvas.getContext('2d');
function updateChart(){
  const counts = {};
  APPS.forEach(a=> counts[a]=0);
  // take last N logs visible (respect filter/search)
  const q = searchInput.value.trim().toLowerCase();
  const appFilter = filterApp.value;
  const visible = logs.filter(l=>{
    if(appFilter && l.app!==appFilter) return false;
    if(q && !(l.app.toLowerCase().includes(q) || l.user.toLowerCase().includes(q) || l.text.toLowerCase().includes(q))) return false;
    return true;
  }).slice(0,200); // limit window
  visible.forEach(l=> counts[l.app] = (counts[l.app]||0)+1);
  // draw bars
  const W = barChartCanvas.width = barChartCanvas.clientWidth;
  const H = barChartCanvas.height = 140;
  chartCtx.clearRect(0,0,W,H);
  const apps = APPS.slice();
  const max = Math.max(1, ...apps.map(a=>counts[a]));
  const pad = 8;
  const bw = (W - pad*2) / apps.length;
  apps.forEach((a,i)=>{
    const v = counts[a];
    const h = Math.round((v / max) * (H - 24));
    const x = pad + i * bw + bw*0.12;
    const barw = bw*0.76;
    // gradient
    const g = chartCtx.createLinearGradient(x, H-h, x+barw, H);
    g.addColorStop(0, 'rgba(229,9,20,0.95)');
    g.addColorStop(1, 'rgba(255,120,120,0.6)');
    chartCtx.fillStyle = g;
    chartCtx.fillRect(x, H-h-8, barw, h+8);
    // label
    chartCtx.fillStyle = 'rgba(255,255,255,0.75)';
    chartCtx.font = '11px system-ui, Arial';
    chartCtx.fillText(a, x, H-2);
  });
}

/* new row highlight handled in renderLogs */

/* online/offline behaviour: pause auto and start prune */
function goOffline(){
  statusDot.style.background = '#e50914';
  statusDot.style.boxShadow = '0 0 8px rgba(229,9,20,0.7)';
  statusLabel.textContent = 'Offline';
  // stop auto
  stopAuto();
  // if prune enabled, start removing oldest entries gradually
  if(pruneCheckbox.checked){
    if(pruneTimer) clearInterval(pruneTimer);
    pruneTimer = setInterval(()=>{
      if(logs.length>0){
        logs.pop(); // remove oldest
        renderLogs();
      }
    }, 2000);
  }
}
function goOnline(){
  statusDot.style.background = 'var(--green)';
  statusDot.style.boxShadow = '0 0 8px rgba(126,217,87,0.85)';
  statusLabel.textContent = 'Online';
  // stop prune
  if(pruneTimer){ clearInterval(pruneTimer); pruneTimer = null; }
  // resume auto if it was on before
  if(autoOn === false && document.getElementById('btnToggleAuto').textContent.includes('ON')) {
    // inconsistent state fix
    startAuto();
  } else {
    // if toggle shows ON, ensure auto runs
    if(document.getElementById('btnToggleAuto').textContent.includes('ON')) startAuto();
  }
}

/* listen to navigator online */
window.addEventListener('online', ()=>{ goOnline(); });
window.addEventListener('offline', ()=>{ goOffline(); });
/* initialize based on current state */
if(navigator.onLine) goOnline(); else goOffline();

/* keep clock */
setInterval(()=>{ timeLabel.textContent = new Date().toLocaleTimeString(); },1000);

/* auto-start and seed */
function seedInitial(){
  for(let i=0;i<14;i++){
    const e = makeRandomEntry(true);
    logs.push({ ts: now(), app:e.app, user:e.user, text:e.text });
  }
  // ensure newest at top
  logs = logs.reverse();
  renderLogs();
}
seedInitial();
startAuto();

/* auto toggle/resume behavior note:
   we store autoOn variable; when user toggles we set autoOn false and stop auto;
   when offline occurs we stopAuto (but preserve autoOn state), and when online we resume only if the toggle indicates ON.
*/
document.getElementById('btnToggleAuto').addEventListener('click', ()=>{
  if(autoOn){
    stopAuto();
    autoOn = false;
  } else {
    startAuto();
    autoOn = true;
  }
});

/* speed changes apply immediately */
speedSelect.addEventListener('change', ()=>{
  if(autoOn) startAuto();
});

/* search/filter live */
searchInput.addEventListener('input', renderLogs);
filterApp.addEventListener('change', renderLogs);
maskCheckbox.addEventListener('change', renderLogs);
pruneCheckbox.addEventListener('change', ()=>{
  if(!pruneCheckbox.checked && pruneTimer){ clearInterval(pruneTimer); pruneTimer=null; }
});

/* helpers for UI niceties */
function updateFilterList(){ /* no-op, filter already filled */ }
updateFilterList();

/* keyboard shortcuts: ctrl+g generate, ctrl+a toggle auto, ctrl+e export */
document.addEventListener('keydown',(e)=>{
  if(e.ctrlKey && e.key.toLowerCase()==='g'){ e.preventDefault(); btnGenerate.click(); }
  if(e.ctrlKey && e.key.toLowerCase()==='a'){ e.preventDefault(); document.getElementById('btnToggleAuto').click(); }
  if(e.ctrlKey && e.key.toLowerCase()==='e'){ e.preventDefault(); btnExport.click(); }
});

/* small visual: when new rows are added frequently, keep chart updated every 1s */
setInterval(()=> updateChart(), 1000);

/* ensure render initially */
renderLogs();

</script>
</body>
</html>




